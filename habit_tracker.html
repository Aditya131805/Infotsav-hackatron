<!DOCTYPE html>
<html lang="en">
<head>
    <title>Habit Tracker</title>
    <link rel="stylesheet" href="styles_home.css">
</head>
<body>
    <h1>Habit Tracker</h1>
    <input type="text" id="habitInput" placeholder="Enter a new habit">
    <select id="frequencyInput">
        <option value="daily">Daily</option>
        <option value="weekly">Weekly</option>
        <option value="monthly">Monthly</option>
        <option value="random">Random</option>
    </select>
    <button onclick="addHabit()">Add Habit</button>
    <h2>Your Habits</h2>
    <table id="habitTable">
        <thead>
            <tr>
                <th>Habit</th>
                <th>Start Date</th>
                <th>Frequency</th>
                <th>Actions</th>
                <th>Tracking</th>
            </tr>
        </thead>
        <tbody id="habitList"></tbody>
    </table>

    <script>
        const habits = JSON.parse(localStorage.getItem('habits')) || {};

        function addHabit() {
            const habitInput = document.getElementById('habitInput');
            const frequencyInput = document.getElementById('frequencyInput');
            const habitName = habitInput.value.trim();
            const frequency = frequencyInput.value;

            if (habitName && !habits[habitName]) {
                const startDate = new Date().toLocaleString();
                habits[habitName] = { startDate: startDate, frequency: frequency, entries: [], tracked: false, remainingDays: 21 };
                habitInput.value = '';
                frequencyInput.value = 'daily'; // Reset to default
                saveHabits();
                displayHabits();
            } else {
                alert('Habit already exists or is empty.');
            }
        }

        function trackHabit(habit) {
            const now = new Date();
            const dateTime = now.toLocaleString();
            habits[habit].entries.push(dateTime);
            habits[habit].tracked = true; // Set tracked status to true

            // Reduce the remaining days
            if (habits[habit].remainingDays > 0) {
                habits[habit].remainingDays -= 1; // Decrement remaining days
            }

            saveHabits();
            displayHabits();
        }

        function editHabit(oldHabitName) {
            const newHabitName = prompt("Edit habit name:", oldHabitName);
            if (newHabitName && !habits[newHabitName]) {
                habits[newHabitName] = habits[oldHabitName];
                delete habits[oldHabitName];
                saveHabits();
                displayHabits();
            } else {
                alert('Habit name is either empty or already exists.');
            }
        }

        function deleteHabit(habit) {
            delete habits[habit];
            saveHabits();
            displayHabits();
        }

        function saveHabits() {
            localStorage.setItem('habits', JSON.stringify(habits));
        }

        function displayHabits() {
            const habitList = document.getElementById('habitList');
            habitList.innerHTML = '';
            for (const habit in habits) {
                const { startDate, frequency, entries, tracked, remainingDays } = habits[habit];
                const latestEntries = entries.slice(-2);

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${habit}</td>
                    <td>${startDate}</td>
                    <td>${frequency}</td>
                    <td>
                        <button onclick="editHabit('${habit}')">Edit</button>
                        <button onclick="deleteHabit('${habit}')">Delete</button>
                        <a href="habit_details.html?habit=${encodeURIComponent(habit)}" class="details-button">
                            <button>Details</button>
                        </a>
                    </td>
                    <td>
                        <button onclick="trackHabit('${habit}')" ${tracked ? 'disabled' : ''}>
                            ${tracked ? 'Tracked' : 'Track'}
                        </button>
                        <div>Remaining Days in 21 Days Challenge: ${remainingDays}</div>
                        <ul>${latestEntries.map(date => `<li>${date}</li>`).join('')}</ul>
                    </td>
                `;
                habitList.appendChild(tr);
            }
        }

        // Initial display of habits
        displayHabits();
    </script>
</body>
</html>
