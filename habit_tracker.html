<!DOCTYPE html>
<html lang="en">
<head>
    <title>Habit Tracker</title>
    <link rel="stylesheet" href="styles_home.css"> <!-- Link to external CSS file -->
</head>
<body>
    <h1>Habit Tracker</h1>
    <input type="text" id="habitInput" placeholder="Enter a new habit"> <!-- Input for new habit name -->
    <select id="frequencyInput"> <!-- Dropdown for habit frequency -->
        <option value="daily">Daily</option>
        <option value="weekly">Weekly</option>
        <option value="monthly">Monthly</option>
    </select>
    <button onclick="addHabit()">Add Habit</button> <!-- Button to add a new habit -->
    <h2>Your Habits</h2>
    <table id="habitTable"> <!-- Table to display the list of habits -->
        <thead>
            <tr>
                <th>Habit</th>
                <th>Start Date</th>
                <th>Frequency</th>
                <th>Actions</th>
                <th>Tracking</th>
            </tr>
        </thead>
        <tbody id="habitList"></tbody> <!-- Container for the habit rows -->
    </table>

    <script>
        // Load habits from local storage or initialize an empty object
        const habits = JSON.parse(localStorage.getItem('habits')) || {};

        // Function to add a new habit
        function addHabit() {
            const habitInput = document.getElementById('habitInput'); 
            const frequencyInput = document.getElementById('frequencyInput'); 
            const habitName = habitInput.value.trim(); 
            const frequency = frequencyInput.value; 

            // Check if the habit name is valid and doesn't already exist
            if (habitName && !habits[habitName]) {
                const startDate = new Date().toLocaleString(); 
                // Create a new habit object
                habits[habitName] = { 
                    startDate: startDate, 
                    frequency: frequency, 
                    entries: [], 
                    tracked: false, 
                    remainingDays: 21,
                    lastTrackedDate: null // Initialize lastTrackedDate
                };
                habitInput.value = ''; 
                frequencyInput.value = 'daily'; 
                saveHabits(); 
                displayHabits(); 
            } else {
                alert('Habit already exists or is empty.'); 
            }
        }

        // Function to track a habit
        function trackHabit(habit) {
            const now = new Date();
            const currentDate = now.toLocaleDateString(); // Get current date in MM/DD/YYYY format

            // Check if today is different from the last tracked date
            if (habits[habit].lastTrackedDate !== currentDate) {
                const dateTime = now.toLocaleString(); 
                habits[habit].entries.push(dateTime); 
                habits[habit].tracked = true; 
                habits[habit].lastTrackedDate = currentDate; // Update the last tracked date

                // Reduce the remaining days if applicable
                if (habits[habit].remainingDays > 0) {
                    habits[habit].remainingDays -= 1; 
                }

                saveHabits(); 
                displayHabits(); 
            } else {
                alert('You have already tracked this habit today.'); 
            }
        }

        // Function to edit an existing habit
        function editHabit(oldHabitName) {
            const newHabitName = prompt("Edit habit name:", oldHabitName); 
            if (newHabitName && !habits[newHabitName]) {
                habits[newHabitName] = habits[oldHabitName]; 
                delete habits[oldHabitName]; 
                saveHabits(); 
                displayHabits(); 
            } else {
                alert('Habit name is either empty or already exists.'); 
            }
        }

        // Function to delete a habit
        function deleteHabit(habit) {
            delete habits[habit]; 
            saveHabits(); 
            displayHabits(); 
        }

        // Function to save habits to local storage
        function saveHabits() {
            localStorage.setItem('habits', JSON.stringify(habits)); 
        }

        // Function to display the list of habits
        function displayHabits() {
            const habitList = document.getElementById('habitList'); 
            habitList.innerHTML = ''; 
            for (const habit in habits) {
                const { startDate, frequency, entries, tracked, remainingDays, lastTrackedDate } = habits[habit]; 
                const latestEntries = entries.slice(-2); 

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${habit}</td>
                    <td>${startDate}</td>
                    <td>${frequency}</td>
                    <td>
                        <button onclick="editHabit('${habit}')">Edit</button>
                        <button onclick="deleteHabit('${habit}')">Delete</button>
                        <a href="habit_details.html?habit=${encodeURIComponent(habit)}" class="details-button">
                            <button>Details</button>
                        </a>
                    </td>
                    <td>
                        <button onclick="trackHabit('${habit}')">
                            ${lastTrackedDate === new Date().toLocaleDateString() ? 'Tracked' : 'Track'}
                        </button>
                        <div>Remaining Days in 21 Days Challenge: ${remainingDays}</div>
                        <ul>${latestEntries.map(date => `<li>${date}</li>`).join('')}</ul>
                    </td>
                `;
                habitList.appendChild(tr); 
            }
        }

        // Initial display of habits when the page loads
        displayHabits();
    </script>
</body>
</html>
