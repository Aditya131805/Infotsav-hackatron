<!DOCTYPE html>
<html lang="en">
<head>
    <title>Habit Tracker</title>
    <link rel="stylesheet" href="styles_home.css"> <!-- Link to external CSS file -->
</head>
<body>
    <h1>Habit Tracker</h1>
    <input type="text" id="habitInput" placeholder="Enter a new habit"> <!-- Input for new habit name -->
    <select id="frequencyInput"> <!-- Dropdown for habit frequency -->
        <option value="daily">Daily</option>
        <option value="weekly">Weekly</option>
        <option value="monthly">Monthly</option>
        <option value="random">Random</option>
    </select>
    <button onclick="addHabit()">Add Habit</button> <!-- Button to add a new habit -->
    <h2>Your Habits</h2>
    <table id="habitTable"> <!-- Table to display the list of habits -->
        <thead>
            <tr>
                <th>Habit</th>
                <th>Start Date</th>
                <th>Frequency</th>
                <th>Actions</th>
                <th>Tracking</th>
            </tr>
        </thead>
        <tbody id="habitList"></tbody> <!-- Container for the habit rows -->
    </table>

    <script>
        // Load habits from local storage or initialize an empty object
        const habits = JSON.parse(localStorage.getItem('habits')) || {};

        // Function to add a new habit
        function addHabit() {
            const habitInput = document.getElementById('habitInput'); // Get habit input element
            const frequencyInput = document.getElementById('frequencyInput'); // Get frequency dropdown
            const habitName = habitInput.value.trim(); // Trim whitespace from habit name
            const frequency = frequencyInput.value; // Get selected frequency

            // Check if the habit name is valid and doesn't already exist
            if (habitName && !habits[habitName]) {
                const startDate = new Date().toLocaleString(); // Get the current date and time
                // Create a new habit object
                habits[habitName] = { 
                    startDate: startDate, 
                    frequency: frequency, 
                    entries: [], 
                    tracked: false, 
                    remainingDays: 21 
                };
                habitInput.value = ''; // Clear input field
                frequencyInput.value = 'daily'; // Reset frequency to default
                saveHabits(); // Save habits to local storage
                displayHabits(); // Update the displayed habits
            } else {
                alert('Habit already exists or is empty.'); // Alert for invalid input
            }
        }

        // Function to track a habit
        function trackHabit(habit) {
            const now = new Date(); // Get the current date
            const dateTime = now.toLocaleString(); // Format the date and time
            habits[habit].entries.push(dateTime); // Add the entry to the habit's entries
            habits[habit].tracked = true; // Mark the habit as tracked

            // Reduce the remaining days if applicable
            if (habits[habit].remainingDays > 0) {
                habits[habit].remainingDays -= 1; // Decrement remaining days
            }

            saveHabits(); // Save updated habits to local storage
            displayHabits(); // Update the displayed habits
        }

        // Function to edit an existing habit
        function editHabit(oldHabitName) {
            const newHabitName = prompt("Edit habit name:", oldHabitName); // Prompt for new name
            // Check if the new name is valid
            if (newHabitName && !habits[newHabitName]) {
                habits[newHabitName] = habits[oldHabitName]; // Copy old habit to new name
                delete habits[oldHabitName]; // Delete the old habit
                saveHabits(); // Save changes
                displayHabits(); // Update the displayed habits
            } else {
                alert('Habit name is either empty or already exists.'); // Alert for invalid input
            }
        }

        // Function to delete a habit
        function deleteHabit(habit) {
            delete habits[habit]; // Remove the habit from the object
            saveHabits(); // Save changes
            displayHabits(); // Update the displayed habits
        }

        // Function to save habits to local storage
        function saveHabits() {
            localStorage.setItem('habits', JSON.stringify(habits)); // Convert habits object to string and save
        }

        // Function to display the list of habits
        function displayHabits() {
            const habitList = document.getElementById('habitList'); // Get the habit list element
            habitList.innerHTML = ''; // Clear the current list
            // Loop through each habit in the habits object
            for (const habit in habits) {
                const { startDate, frequency, entries, tracked, remainingDays } = habits[habit]; // Destructure habit properties
                const latestEntries = entries.slice(-2); // Get the last two entries

                // Create a new table row for each habit
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${habit}</td>
                    <td>${startDate}</td>
                    <td>${frequency}</td>
                    <td>
                        <button onclick="editHabit('${habit}')">Edit</button>
                        <button onclick="deleteHabit('${habit}')">Delete</button>
                        <a href="habit_details.html?habit=${encodeURIComponent(habit)}" class="details-button">
                            <button>Details</button>
                        </a>
                    </td>
                    <td>
                        <button onclick="trackHabit('${habit}')" ${tracked ? 'disabled' : ''}>
                            ${tracked ? 'Tracked' : 'Track'}
                        </button>
                        <div>Remaining Days in 21 Days Challenge: ${remainingDays}</div>
                        <ul>${latestEntries.map(date => `<li>${date}</li>`).join('')}</ul>
                    </td>
                `;
                habitList.appendChild(tr); // Append the row to the habit list
            }
        }

        // Initial display of habits when the page loads
        displayHabits();
    </script>
</body>
</html>
